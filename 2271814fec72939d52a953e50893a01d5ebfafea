{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ecb9679f_11a0cfbb",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-08-15T06:56:04Z",
      "side": 1,
      "message": "No, only the owners of the serviceuser. And IMo this is valid, even required, since during creation of the sreviceuser a SSH key is required to have a way to authenticate it and owners want serviceusers to be able to use SSH for git requests.",
      "range": {
        "startLine": 9,
        "startChar": 10,
        "endLine": 9,
        "endChar": 18
      },
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7fabb636_4b1ac0ee",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1040243
      },
      "writtenOn": "2022-08-15T07:11:49Z",
      "side": 1,
      "message": "Why there is a different between adding SSH credentials and HTTP credentials? Or modifying any attribute?\n\nI prefer to manage all credentials in symmetric way, so that admin or service user creator can create/modify or delegate specific tasks to people.",
      "parentUuid": "ecb9679f_11a0cfbb",
      "range": {
        "startLine": 9,
        "startChar": 10,
        "endLine": 9,
        "endChar": 18
      },
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "73386395_d3c8d380",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-08-22T09:52:35Z",
      "side": 1,
      "message": "See my answer in the other comment.",
      "parentUuid": "7fabb636_4b1ac0ee",
      "range": {
        "startLine": 9,
        "startChar": 10,
        "endLine": 9,
        "endChar": 18
      },
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d88132d7_a292c747",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-08-15T06:56:04Z",
      "side": 1,
      "message": "This is already the case. Non-owners/-admins will get Not found, if trying to add an SSH key of a serviceuser.",
      "range": {
        "startLine": 12,
        "startChar": 0,
        "endLine": 13,
        "endChar": 57
      },
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "62a1d2b4_2afff099",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1040243
      },
      "writtenOn": "2022-08-15T07:11:49Z",
      "side": 1,
      "message": "I will fix my phrase.",
      "parentUuid": "d88132d7_a292c747",
      "range": {
        "startLine": 12,
        "startChar": 0,
        "endLine": 13,
        "endChar": 57
      },
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1064a362_1f378336",
        "filename": "gr-serviceuser/gr-serviceuser-create.js",
        "patchSetId": 1
      },
      "lineNbr": 99,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-08-15T06:56:04Z",
      "side": 1,
      "message": "_allowSsh",
      "range": {
        "startLine": 99,
        "startChar": 15,
        "endLine": 99,
        "endChar": 24
      },
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "65e19808_d9f84eaf",
        "filename": "gr-serviceuser/gr-serviceuser-create.js",
        "patchSetId": 1
      },
      "lineNbr": 99,
      "author": {
        "id": 1040243
      },
      "writtenOn": "2022-08-15T07:11:49Z",
      "side": 1,
      "message": "I copied the allow_email all over, I will.",
      "parentUuid": "1064a362_1f378336",
      "range": {
        "startLine": 99,
        "startChar": 15,
        "endLine": 99,
        "endChar": 24
      },
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9ad90a3c_596decc9",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/serviceuser/AddSshKey.java",
        "patchSetId": 1
      },
      "lineNbr": 57,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-08-15T06:56:04Z",
      "side": 1,
      "message": "The ServiceUserResource ensures that only owners and admins will be able to retrieve the resource. Thus, if a user is not the owner, a ResourceNotFound exception is thrown and modifying the SSH keys fails.",
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a41fb240_d202c03a",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/serviceuser/AddSshKey.java",
        "patchSetId": 1
      },
      "lineNbr": 57,
      "author": {
        "id": 1040243
      },
      "writtenOn": "2022-08-15T07:11:49Z",
      "side": 1,
      "message": "The question is if we want to allow owners to modify credentials always, and if we do, why do we limit them managing other credentials (HTTP)?",
      "parentUuid": "9ad90a3c_596decc9",
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9ff1252f_efb47ac5",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/serviceuser/AddSshKey.java",
        "patchSetId": 1
      },
      "lineNbr": 57,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-08-22T09:52:35Z",
      "side": 1,
      "message": "Yes, we want to. Managing serviceusers should be a self service. On large Gerrit instances this is otherwise not manageable, i.e. server admins cannot maintain credentials for hundreds of serviceusers used by hundreds of teams. However, changing credentials has to be strictly limited to the. serviceuser\u0027s owner(s), which then are responsible to secure those credentials (private key, password).\n\nThe `allowHttpPassword` option is a valid point. However, with SSH it is more difficult, since currently a SSH key is required during creation and thus non admin users have to be able to set a SSH key to be able to create a serviceuser. The restriction that a serviceuser has to have a SSH key during creation was put in place, since a serviceuser without any credential does not make sense. IMO, this restriction could also be removed and in case no SSH key is provided a password is generated and shown to the creator after the serviceuser was created. With your change the creator (default owner) would be allowed to set the initial SSH key, but then would not be allowed to change it anymore. I don\u0027t think that this makes sense. It should then not be allowed to set one in the first place, if the creator is not an admin.",
      "parentUuid": "a41fb240_d202c03a",
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "95290e5a_24d8c530",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/serviceuser/AddSshKey.java",
        "patchSetId": 1
      },
      "lineNbr": 57,
      "author": {
        "id": 1040243
      },
      "writtenOn": "2022-08-24T16:02:38Z",
      "side": 1,
      "message": "Hi Thomas,\n\nI am confused from your reply.\n\nFor my understanding we have four (4) levels of permissions:\n\n1. \"Administrate Server\" capability\n2. \"Create Service User\" capability\n3. \"Owner Group\" user setting\n4. Any user\n\nThe (1) and (2) can be used to create service users. They can set any setting on this user, including SSH public key and any other setting. These users may set the owner group of a user so that (3) may manage the user.\n\n(3) is used to manage *existing* users, created by (1) or (2). It cannot create new users. The attributes it may set is restricted by the `serviceuser` plugin configuration. The configuration enables (1) to control which attribute may (3) modify, all but the SSH public keys. I am unsure why at first stage there are limitations for the owner group members, however, I believe we should be consistent and allow (1) to control all attributes, especially the sensitive ones such as authentication credentials.\n\n(4) Cannot modify the service users unless part of (3) with limitations, (2) or (1).\n\nFrom what I understand from your reply, you write that (3) can create users so the configuration of what attribute it may modify affect the creation method, this is why the SSH public key must be allowed, as (3) should be able to create users and must specify SSH public key. However, (3) cannot create users, only (1) and (2) can create users, (3) is managing post creation user management so restricting the SSH public key modification does not affect the user creation.\n\nBTW: in my use case I create the service user with dummy SSH key, create HTTP password and remove the SSH key... as it is not required in the use case... We should consider removing this enforcement.\n\nWhat am I missing?\n\nThanks,\nAlon",
      "parentUuid": "9ff1252f_efb47ac5",
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a71d44ca_d92d20df",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/serviceuser/AddSshKey.java",
        "patchSetId": 1
      },
      "lineNbr": 57,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-08-25T06:29:16Z",
      "side": 1,
      "message": "Hi Alon,\nthanks for the explanation. You are right. That makes sense. I got a bit confused, becuase I didn\u0027t take your recent change about owners without createServiceuser capabilities into account and about the permission check you are doing here (see my other comment).",
      "parentUuid": "95290e5a_24d8c530",
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b62dfc96_b87f028e",
        "filename": "src/main/resources/Documentation/config.md",
        "patchSetId": 1
      },
      "lineNbr": 50,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-08-15T06:56:04Z",
      "side": 1,
      "message": "ssh keys",
      "range": {
        "startLine": 50,
        "startChar": 46,
        "endLine": 50,
        "endChar": 61
      },
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "91162d4b_2f7ebf9f",
        "filename": "src/main/resources/Documentation/config.md",
        "patchSetId": 1
      },
      "lineNbr": 50,
      "author": {
        "id": 1040243
      },
      "writtenOn": "2022-08-15T07:11:49Z",
      "side": 1,
      "message": "thanks! sorry for that.",
      "parentUuid": "b62dfc96_b87f028e",
      "range": {
        "startLine": 50,
        "startChar": 46,
        "endLine": 50,
        "endChar": 61
      },
      "revId": "2271814fec72939d52a953e50893a01d5ebfafea",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}