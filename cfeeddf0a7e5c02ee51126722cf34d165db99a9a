{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "db86390f_50a4e245",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017568
      },
      "writtenOn": "2021-02-10T14:41:10Z",
      "side": 1,
      "message": "This is actually causing an issue now. As far as `serviceuser`, it works fine indeed : service users can be managed from UI, create via SSH and so on.\n\nHowever, it prevents regular push via HTTPS. When pushing,  ValidateServiceUserCommits.onCommitReceived() gets called, which ends up calling GetServiceUser.apply() to find if the user is a service user; it seems to work fine via SSH, but when called via HTTPS there is no `IdentifiedUser` to setup the MetadataUserUpdate, and push is rejected with a exception:\n\n git-receive-pack ERROR com.google.gerrit.server.git.receive.AsyncReceiveCommits : error while processing push\n java.util.concurrent.ExecutionException: com.google.common.util.concurrent.UncheckedExecutionException: com.google.inject.ProvisionException: Unable to provision, see the following errors:\n\n 1) Not Signed In\n   at com.google.gerrit.server.util.ThreadLocalRequestContext$1.provideCurrentUser(Unknown Source) (via modules: com.google.gerrit.server.config.GerritGlobalModule -\u003e com.google.gerrit.server.util.ThreadLocalRequestContext$1)\n   while locating com.google.gerrit.server.IdentifiedUser\n   at com.google.gerrit.server.plugins.PluginGuiceEnvironment$2.configure(PluginGuiceEnvironment.java:551) (via modules: com.google.gerrit.server.plugins.PluginGuiceEnvironment$1 -\u003e com.google.gerrit.server.plugins.PluginGuiceEnvironment$2)\n   while locating com.google.gerrit.server.IdentifiedUser\n\nAny hint where/how to get/set the current user?",
      "revId": "cfeeddf0a7e5c02ee51126722cf34d165db99a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "62b64951_74496603",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017568
      },
      "writtenOn": "2021-02-10T15:11:08Z",
      "side": 1,
      "message": "Same issue actually happens also in RefUpdateListener.onGitReferenceUpdated(), although it does not prevent the commit from being integrated.",
      "parentUuid": "db86390f_50a4e245",
      "revId": "cfeeddf0a7e5c02ee51126722cf34d165db99a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e75ffb60_0651b753",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2021-02-15T12:13:22Z",
      "side": 1,
      "message": "OK, thanks for reporting this back. I will try to fix that today.",
      "parentUuid": "62b64951_74496603",
      "revId": "cfeeddf0a7e5c02ee51126722cf34d165db99a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "350c6c90_08bb7f90",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2021-02-15T13:00:23Z",
      "side": 1,
      "message": "Hmm.. on my first test I couldn\u0027t reproduce the issue. A push (for review) from a service user succeeded...\n\nCan you please describe step-by-step how to reproduce the issue?\n\n\u003e This is actually causing an issue now.\n\nCould you actually confirm that it is exactly *this* change that is causing the issue? Have you tried building the service user plugin without this change? Is the issue then gone?",
      "parentUuid": "e75ffb60_0651b753",
      "revId": "cfeeddf0a7e5c02ee51126722cf34d165db99a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "93abdaf8_7965fa34",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2021-02-15T13:01:11Z",
      "side": 1,
      "message": "Forgot to write that I pushed over the http protocol when it succeeded.",
      "parentUuid": "350c6c90_08bb7f90",
      "revId": "cfeeddf0a7e5c02ee51126722cf34d165db99a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "697f976d_15e0db4e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2021-02-15T13:29:15Z",
      "side": 1,
      "message": "OK, on a second trial I did reproduce the issue",
      "parentUuid": "93abdaf8_7965fa34",
      "revId": "cfeeddf0a7e5c02ee51126722cf34d165db99a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a23ad8c1_4facf435",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/serviceuser/StorageCache.java",
        "patchSetId": 1
      },
      "lineNbr": 36,
      "author": {
        "id": 1017568
      },
      "writtenOn": "2021-02-08T09:32:20Z",
      "side": 1,
      "message": "should this not use something more explicitely linking with service-user plugin?",
      "range": {
        "startLine": 36,
        "startChar": 44,
        "endLine": 36,
        "endChar": 51
      },
      "revId": "cfeeddf0a7e5c02ee51126722cf34d165db99a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "028f8cc2_19030d59",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/serviceuser/StorageCache.java",
        "patchSetId": 1
      },
      "lineNbr": 36,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2021-02-08T09:34:31Z",
      "side": 1,
      "message": "Each cache defined in a plugin will automatically get plugins name prefixed to the name.\nTherefore, when using Gerrit\u0027s show-caches command this cache will be shown as \"serviceuser-storage\" in the output.",
      "parentUuid": "a23ad8c1_4facf435",
      "range": {
        "startLine": 36,
        "startChar": 44,
        "endLine": 36,
        "endChar": 51
      },
      "revId": "cfeeddf0a7e5c02ee51126722cf34d165db99a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "978da171_61e76202",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/serviceuser/StorageCache.java",
        "patchSetId": 1
      },
      "lineNbr": 36,
      "author": {
        "id": 1017568
      },
      "writtenOn": "2021-02-08T09:40:01Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "028f8cc2_19030d59",
      "range": {
        "startLine": 36,
        "startChar": 44,
        "endLine": 36,
        "endChar": 51
      },
      "revId": "cfeeddf0a7e5c02ee51126722cf34d165db99a9a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}